apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-init-scripts
  namespace: introbbdd
data:
  01-empleados.sql: |
    DROP DATABASE IF EXISTS EMPLEADOS;
    CREATE DATABASE EMPLEADOS;
    ALTER DATABASE EMPLEADOS DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

    use EMPLEADOS;

    DROP TABLE IF EXISTS TEMPLE;
    DROP TABLE IF EXISTS TDEPTO;
    DROP TABLE IF EXISTS TCENTR;

    CREATE TABLE TCENTR
    (NUMCE INTEGER NOT NULL,
     NOMCE VARCHAR(30) NOT NULL,
     SENAS VARCHAR(50) NOT NULL,
     PRIMARY KEY (NUMCE))
     ENGINE=InnoDB;


    CREATE TABLE TDEPTO
    (NUMDE INTEGER NOT NULL,
     NUMCE INTEGER,
     DIREC INTEGER NOT NULL,
     TIDIR CHAR(1) NOT NULL,
     PRESU DECIMAL(6,1) NOT NULL,
     DEPDE INTEGER,
     NOMDE VARCHAR(20) NOT NULL,
     PRIMARY KEY (NUMDE),
     FOREIGN KEY (NUMCE) REFERENCES TCENTR(NUMCE) ON DELETE RESTRICT )
     ENGINE=InnoDB;


    CREATE TABLE TEMPLE
    (NUMEM INTEGER       NOT NULL,
     NUMDE INTEGER       NOT NULL,
     EXTEL INTEGER       NOT NULL,
     FECNA DATE          NOT NULL,
     FECIN DATE          NOT NULL,
     SALAR DECIMAL(6,1)  NOT NULL,
     COMIS DECIMAL(6,1),
     NUMHI SMALLINT      NOT NULL,
     NOMEM VARCHAR(20)   NOT NULL,
     PRIMARY KEY (NUMEM),
     FOREIGN KEY (NUMDE) REFERENCES TDEPTO (NUMDE) ON DELETE RESTRICT )
     ENGINE=InnoDB;



    LOAD DATA INFILE '/var/lib/mysql-files/tcentr.txt' INTO TABLE TCENTR;
    LOAD DATA INFILE '/var/lib/mysql-files/tdepto.txt' INTO TABLE TDEPTO;
    LOAD DATA INFILE '/var/lib/mysql-files/temple.txt' INTO TABLE TEMPLE;

  02-autobuses.sql: |
    DROP DATABASE IF EXISTS BDAUTOBUSES;
    CREATE DATABASE IF NOT EXISTS BDAUTOBUSES;
    USE BDAUTOBUSES;

    DROP TABLE IF EXISTS PASAJEROS;
    DROP TABLE IF EXISTS AUTOBUSES;
    DROP TABLE IF EXISTS TRAYECTOS;
    DROP TABLE IF EXISTS BILLETES;


    CREATE TABLE PASAJEROS (
      DNI varchar(10) NOT NULL,
      NOMBRE varchar(25),
      TLFN varchar(9),
      PRIMARY KEY (DNI)
    ) ENGINE=InnoDB DEFAULT CHARSET=latin1; 


    CREATE TABLE AUTOBUSES (
      MATRIC varchar(10) NOT NULL,
      NASIENTOS int(11) ,
      ITV date ,
      PRIMARY KEY (MATRIC)
    ) ENGINE=InnoDB DEFAULT CHARSET=latin1;


    CREATE TABLE TRAYECTOS (
      CODTRAY varchar(10) NOT NULL,
      ORIG varchar(15),
      DEST varchar(15),
      PRECIO decimal(4,2),
      KM int(11),
      PRIMARY KEY (CODTRAY)
    ) ENGINE=InnoDB DEFAULT CHARSET=latin1; 


    CREATE TABLE BILLETES (
      CBILL int(11) NOT NULL,
      CODTRAY char(8) NOT NULL,
      MATRIC char(7) NOT NULL,
      DNI char(10) NOT NULL,
      FECHA date DEFAULT NULL,
      HORA time,
      PRIMARY KEY (CBILL),
      KEY CODTRAY (CODTRAY),
      KEY MATRIC (MATRIC),
      KEY DNI (DNI),
      CONSTRAINT BILLETES_ibfk_1 FOREIGN KEY (CODTRAY) REFERENCES TRAYECTOS (CODTRAY) ON DELETE CASCADE,
      CONSTRAINT BILLETES_ibfk_2 FOREIGN KEY (MATRIC) REFERENCES AUTOBUSES (MATRIC) ON DELETE CASCADE,
      CONSTRAINT BILLETES_ibfk_3 FOREIGN KEY (DNI) REFERENCES PASAJEROS (DNI) ON DELETE CASCADE
    ) ENGINE=InnoDB DEFAULT CHARSET=latin1; 


    LOAD DATA LOCAL INFILE '/autobuses/pasajeros' INTO TABLE PASAJEROS;
    LOAD DATA LOCAL INFILE '/autobuses/autobuses' INTO TABLE AUTOBUSES;
    LOAD DATA LOCAL INFILE '/autobuses/trayectos' INTO TABLE TRAYECTOS;
    LOAD DATA LOCAL INFILE '/autobuses/billetes' INTO TABLE BILLETES;